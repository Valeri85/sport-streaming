# Master .htaccess for all streaming websites

# CloudFlare handles HTTPS, .htaccess handles WWW and Language URLs

RewriteEngine On

# ==========================================

# 1. FORCE WWW (Only this redirect!)

# ==========================================

RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteRule ^(.\*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# ==========================================

# 2. SITEMAP & ROBOTS

# ==========================================

RewriteRule ^sitemap\.xml$ sitemap.php [L]
RewriteRule ^robots\.txt$ robots.php [L]

# ==========================================

# 3. PREVENT REWRITING FOR ACTUAL FILES

# ==========================================

RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# ==========================================

# 4. LANGUAGE URL ROUTING

# Route /xx or /xx-xx (2 or 5 letter language code) to index.php

# Examples:

# /es → index.php?url_lang=es

# /pt-br → index.php?url_lang=pt-br

# /es/ → index.php?url_lang=es

# /es/favorites → index.php?url_lang=es (favorites route)

# /pt-br/live-football → index.php?url_lang=pt-br (sport route)

# ==========================================

# Language + Favorites: /xx/favorites or /xx-xx/favorites

RewriteRule ^([a-z]{2}(-[a-z]{2})?)/favorites/?$ index.php?url_lang=$1&view=favorites [L,QSA]

# Language + Sport: /xx/live-sport-name or /xx-xx/live-sport-name

RewriteRule ^([a-z]{2}(-[a-z]{2})?)/live-([a-z-]+)/?$ index.php?url_lang=$1&sport=$3 [L,QSA]

# Language only: /xx or /xx/ or /xx-xx or /xx-xx/

RewriteRule ^([a-z]{2}(-[a-z]{2})?)/?$ index.php?url_lang=$1 [L,QSA]

# ==========================================

# 5. VIRTUAL ROUTES (without language prefix)

# ==========================================

RewriteRule ^favorites/?$ index.php?view=favorites [L,QSA]
RewriteRule ^live-([a-z-]+)/?$ index.php?sport=$1 [L,QSA]

# ==========================================

# 6. SECURITY

# ==========================================

<FilesMatch "^(config|data\.json|websites\.json)">
Order allow,deny
Deny from all
</FilesMatch>

<FilesMatch "^\.">
Order allow,deny
Deny from all
</FilesMatch>

# ==========================================

# 7. SETTINGS

# ==========================================

Options -Indexes
AddDefaultCharset UTF-8
