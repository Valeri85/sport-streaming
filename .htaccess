# Master .htaccess for all streaming websites
# CloudFlare handles HTTPS, .htaccess handles WWW

RewriteEngine On

# ==========================================
# 1. FORCE WWW (Only this redirect!)
# ==========================================
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# ==========================================
# 2. SITEMAP & ROBOTS
# ==========================================
RewriteRule ^sitemap\.xml$ sitemap.php [L]
RewriteRule ^robots\.txt$ robots.php [L]

# ==========================================
# 3. PREVENT REWRITING FOR ACTUAL FILES
# ==========================================
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# ==========================================
# 4. VIRTUAL ROUTES
# ==========================================
RewriteRule ^favorites/?$ index.php [L,QSA]
RewriteRule ^live-([a-z-]+)/?$ index.php [L,QSA]

# ==========================================
# 5. SECURITY
# ==========================================
<FilesMatch "^(config|data\.json|websites\.json)">
Order allow,deny
Deny from all
</FilesMatch>

<FilesMatch "^\.">
Order allow,deny
Deny from all
</FilesMatch>

# ==========================================
# 6. SETTINGS
# ==========================================
Options -Indexes
AddDefaultCharset UTF-8