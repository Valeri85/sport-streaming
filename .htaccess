# Master .htaccess for all streaming websites

# Location: /var/www/u1852176/data/www/streaming/.htaccess

RewriteEngine On

# ========================================

# STEP 1: Force HTTPS + WWW (combined for proper path preservation)

# ========================================

# If not HTTPS, redirect to HTTPS with www

RewriteCond %{HTTPS} off
RewriteCond %{HTTP_HOST} ^www\. [NC]
RewriteRule ^(.\*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

RewriteCond %{HTTPS} off
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteRule ^(.\*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# If HTTPS but no www, add www

RewriteCond %{HTTPS} on
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteRule ^(.\*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

# ========================================

# STEP 2: SEO-Friendly URLs - Sitemap & Robots (NO conditions needed)

# These MUST come BEFORE the general file check

# ========================================

# Sitemap: /sitemap.xml → sitemap.php

RewriteRule ^sitemap\.xml$ sitemap.php [L,QSA]

# Robots: /robots.txt → robots.php

RewriteRule ^robots\.txt$ robots.php [L,QSA]

# ========================================

# STEP 3: Virtual URL rewrites (WITH conditions to prevent rewriting real files)

# ========================================

# Favorites page: /favorites → index.php

# Condition: Only if /favorites is NOT a real file or directory

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^favorites/?$ index.php [L,QSA]

# Live sport pages: /live-football → index.php

# Condition: Only if /live-\* is NOT a real file or directory

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^live-([a-z-]+)/?$ index.php [L,QSA]

# ========================================

# SECURITY: Prevent access to config and sensitive files

# ========================================

<FilesMatch "^(config|data\.json|websites\.json|notified-sports\.json|slack-config\.json)">
Order allow,deny
Deny from all
</FilesMatch>

# Prevent access to hidden files (like .htaccess, .git, etc.)

<FilesMatch "^\.">
Order allow,deny
Deny from all
</FilesMatch>

# ========================================

# GENERAL SETTINGS

# ========================================

# Prevent directory listing

Options -Indexes

# Force UTF-8 encoding

AddDefaultCharset UTF-8
